version: '3.7'

volumes:
    postgres-data: {}

services:
    frontend: &frontend
        build: &build
            dockerfile: 'infrastructure/docker/services/php/Dockerfile'
            context: .
            target: prod
            args:
                - USER_ID=${UID:-1000}
        depends_on:
            - postgres
        environment:
            - FRANKENPHP_CONFIG="worker /app/public/index.php"
            - "APP_RUNTIME=Runtime\\FrankenPhpSymfony\\Runtime"

    cron:
        <<: *frontend
        build:
            <<: *build
            target: cron

    postgres:
        build: 'infrastructure/docker/services/postgres'
        environment:
            POSTGRES_PASSWORD: qotd
            POSTGRES_USER: qotd
            POSTGRES_DB: qotd
        volumes:
            - postgres-data:/var/lib/postgresql/data
